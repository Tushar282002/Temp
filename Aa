
Here's the updated code with minimum 3 characters search requirement and console logging to see the API data:
1. Updated Search Component TypeScript
employee-multi-select-search.component.ts
import { NgIf } from '@angular/common';
import { Component, Input, ViewEncapsulation, signal, ViewChild, ElementRef, Output, EventEmitter } from '@angular/core';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { MatSelectModule, MatSelect } from '@angular/material/select';
import { MatCheckboxModule } from '@angular/material/checkbox';
import { MatFormFieldModule } from '@angular/material/form-field';
import { MatOptionModule } from '@angular/material/core';
import { MatAutocompleteModule } from '@angular/material/autocomplete';
import { MatTooltipModule } from '@angular/material/tooltip';
import { SearchAutoCompleteComponent } from '../abstractions/search-autocomplete.component';
import { createControlValueAccessorProviders } from '../abstractions/control-value-accessor-base';
import { OptionInfo } from '../abstractions/options-parent-base';

@Component({
  selector: 'app-employee-multi-select-search',
  standalone: true,
  imports: [
    MatAutocompleteModule,
    MatFormFieldModule,
    MatOptionModule,
    MatCheckboxModule,
    NgIf,
    FormsModule,
    ReactiveFormsModule,
    MatTooltipModule
  ],
  templateUrl: './employee-multi-select-search.component.html',
  styleUrls: ['./employee-multi-select-search.component.scss'],
  encapsulation: ViewEncapsulation.None,
  providers: createControlValueAccessorProviders(EmployeeMultiSelectSearchComponent)
})
export class EmployeeMultiSelectSearchComponent<T> extends SearchAutoCompleteComponent<T> {
  
  @ViewChild('searchInput') searchInputElement?: ElementRef<HTMLInputElement>;
  
  //#region Input Properties
  
  @Input() addInitialItemsCallback?: () => T[];
  @Input() override displayMemberPath = '{fullName} ({emailAddress})';
  @Input() override inputPlaceholder: string = 'Search employees...';
  @Input() noResultsMessage: string = 'No results found in Employee Directory';
  @Input() minSearchLength: number = 3; // Minimum characters required for search
  
  //#endregion
  
  //#region Output Events
  
  @Output() employeeSelected = new EventEmitter<T>();
  
  //#endregion
  
  //#region Private Properties
  
  private employeeMap = new Map<string, T>();
  
  //#endregion
  
  //#region Public Properties for Template
  
  showMinLengthMessage = signal<boolean>(false);
  
  //#endregion
  
  //#region Lifecycle Hooks
  
  override ngOnInit(): void {
    super.ngOnInit();
  }
  
  ngAfterViewInit(): void {
    setTimeout(() => {
      this.filteredOptions.set([]);
      if (this.searchInputElement) {
        this.searchInputElement.nativeElement.value = '';
      }
    }, 0);
  }
  
  //#endregion
  
  //#region Input Handling
  
  override onInputChange(event: Event): void {
    const input = event.target as HTMLInputElement;
    const value = input.value.trim();
    
    // Clear results if empty
    if (value.length === 0) {
      this.filteredOptions.set([]);
      this.employeeMap.clear();
      this.showMinLengthMessage.set(false);
      return;
    }
    
    // Check minimum length requirement
    if (value.length < this.minSearchLength) {
      this.filteredOptions.set([]);
      this.employeeMap.clear();
      this.showMinLengthMessage.set(true);
      console.log(`Search requires at least ${this.minSearchLength} characters. Current: ${value.length}`);
      return;
    }
    
    // Hide minimum length message once requirement is met
    this.showMinLengthMessage.set(false);
    
    // Perform search
    if (this.searchItemsCallback) {
      this.isSearchInProgress = true;
      console.log('üîç Searching for:', value);
      
      this.searchItemsCallback(value).subscribe({
        next: (results: T[]) => {
          console.log('‚úÖ API Response - Total Results:', results.length);
          console.log('üìã Full API Data:', results);
          
          // Log each employee detail
          results.forEach((employee, index) => {
            console.log(`Employee ${index + 1}:`, employee);
          });
          
          this.employeeMap.clear();
          
          const options = results.map(result => {
            const displayValue = this.getViewValue(result);
            console.log('Display Value:', displayValue);
            const optionInfo = new OptionInfo(result, displayValue);
            this.employeeMap.set(optionInfo.objectAsString, result);
            return optionInfo;
          });
          
          this.filteredOptions.set(options);
          this.isSearchInProgress = false;
          
          console.log('‚úÖ Options created:', options.length);
        },
        error: (error) => {
          console.error('‚ùå API Error:', error);
          this.isSearchInProgress = false;
          this.filteredOptions.set([]);
          this.employeeMap.clear();
        }
      });
    }
  }
  
  searchOnClick(): void {
    if (this.searchInputElement) {
      this.searchInputElement.nativeElement.focus();
    }
  }
  
  //#endregion
  
  //#region Selection Methods
  
  onCheckboxChange(option: OptionInfo<T>, event: any): void {
    event.stopPropagation();
    const employee = this.employeeMap.get(option.objectAsString);
    if (employee) {
      console.log('‚úÖ Employee Selected:', employee);
      console.log('üìß Employee Email:', (employee as any).emailAddress);
      console.log('üë§ Employee Name:', (employee as any).fullName);
      this.employeeSelected.emit(employee);
    }
  }
  
  usingDisplayValue = (): string => {
    return '';
  };
  
  //#endregion
}
2. Updated Search Component HTML
employee-multi-select-search.component.html
<div>
  <div [class]="isInvalid ? 'form-group' : ''">
    <div 
      [class]="{
        'input-group': true, 
        'input-search-box': true, 
        'is-invalid': (isInvalid && validationType === 2), 
        'soft-is-invalid': (isInvalid && validationType === 1)
      }">
      
      <input 
        #searchInput
        aria-label="Search Employee"
        class="input-text form-control" 
        [matAutocomplete]="autoComplete" 
        (input)="onInputChange($event)"
        [placeholder]="inputPlaceholder" 
        [readonly]="isSearchInProgress"
        style="background-color:#FAFDFC;">
      
      <div class="input-group-append" (click)="searchOnClick()">
        <span class="input-group-text no-border-left" title="Search">
          <i *ngIf="isSearchInProgress" class="once-loader once-loader-xs"></i>
          <i *ngIf="!isSearchInProgress" class="icon icon-search"></i>
        </span>
      </div>
    </div>

    <mat-autocomplete 
      #autoComplete="matAutocomplete"
      [displayWith]="usingDisplayValue">
      
      <div class="autocomplete-wrapper">
        @for (option of filteredOptions(); track option.objectAsString) {
          <mat-option 
            [value]="option" 
            matTooltipClass="tooltip" 
            [matTooltip]="option.displayValue"
            class="option-style-truncate">
            <mat-checkbox 
              [checked]="false"
              (change)="onCheckboxChange(option, $event)"
              (click)="$event.stopPropagation()"
              class="option-checkbox">
              {{ option.displayValue }}
            </mat-checkbox>
          </mat-option>
        }
      </div>
      
      <!-- Minimum Length Message -->
      <mat-option *ngIf="showMinLengthMessage()" disabled class="min-length-message">
        Please enter at least {{ minSearchLength }} characters to search
      </mat-option>
      
      <!-- No Results Message -->
      <mat-option *ngIf="filteredOptions()?.length === 0 && searchInput.value && searchInput.value.length >= minSearchLength && !isSearchInProgress" disabled>
        {{ noResultsMessage }}
      </mat-option>
    </mat-autocomplete>

    <div 
      *ngIf="isInvalid && showValidationMessage"
      [class]="{
        'crm-form-error-feedback': (isInvalid && validationType === 2), 
        'soft-invalid-feedback': (isInvalid && validationType === 1)
      }">
      <i class="icon icon-error"></i>
      {{ errorMessage }}
    </div>
  </div>
</div>
3. Updated Search Component CSS (Add min-length message style)
employee-multi-select-search.component.scss
.autocomplete-wrapper {
  flex: 1 1 auto;
  overflow-y: auto;
  max-height: 300px;
}

.cursor-class {
  cursor: pointer;
}

.option-style-truncate {
  width: 100% !important;
  overflow-x: hidden !important;
  text-overflow: ellipsis !important;
  white-space: nowrap !important;
  display: block !important;
  justify-content: start !important;
  align-content: center !important;
  padding: 0 !important;
  
  .option-checkbox {
    width: 100%;
    padding: 8px 16px;
    margin: 0;
    
    ::ng-deep {
      .mdc-checkbox {
        margin-right: 12px;
      }
      
      .mdc-label {
        width: 100%;
        cursor: pointer;
      }
    }
  }
}

.min-length-message {
  padding: 12px 16px !important;
  color: #666;
  font-style: italic;
  font-size: 14px;
  text-align: center;
}

.form-control[readonly], .form-control:disabled {
  margin-left: 0px;
}

.input-search-box {
  position: relative;
  
  .input-text {
    border-right: none;
    
    &:focus {
      border-color: #80bdff;
      outline: 0;
      box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
  }
  
  .input-group-append {
    .input-group-text {
      background-color: #fff;
      border-left: none;
      cursor: pointer;
      
      &.no-border-left {
        border-left: 1px solid #ced4da;
      }
    }
  }
  
  &.is-invalid {
    .input-text,
    .input-group-text {
      border-color: #dc3545;
    }
  }
  
  &.soft-is-invalid {
    .input-text,
    .input-group-text {
      border-color: #ffc107;
    }
  }
}

.crm-form-error-feedback {
  color: #dc3545;
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: flex;
  align-items: center;
  
  i {
    margin-right: 4px;
  }
}

.soft-invalid-feedback {
  color: #ffc107;
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: flex;
  align-items: center;
  
  i {
    margin-right: 4px;
  }
}

.tooltip {
  font-size: 12px;
  max-width: 300px;
}

::ng-deep {
  .mat-mdc-autocomplete-panel {
    .option-style-truncate {
      &:hover {
        background-color: rgba(0, 0, 0, 0.04);
      }
    }
  }
}
4. Updated Visibility Component (with detailed logging)
opportunity-visibility.component.ts
onEmployeeSelected(employee: IBnppParticipant): void {
  console.log('üéØ Employee received in visibility component:', employee);
  console.log('üìã Employee properties:', {
    fullName: employee.fullName,
    emailAddress: employee.emailAddress,
    employeeId: employee.employeeId,
    positionId: employee.positionId,
    uid: (employee as any).uid,
    firstName: (employee as any).firstName,
    lastName: (employee as any).lastName,
    allProperties: employee
  });
  
  const currentData = this.rowData();
  console.log('üìä Current grid data:', currentData);
  
  const newEntry: IAccessList = {
    id: this.generateTempId(),
    employeeName: employee.fullName,
    emailAddress: employee.emailAddress,
    employeeId: employee.employeeId,
    teamName: '',
    visibilityRules: 'Manually Added',
    addedBy: `${this.userService.context?.firstName} ${this.userService.context?.lastName}`,
    isManuallyAdded: true
  };
  
  console.log('‚ûï New entry to be added:', newEntry);
  
  this.rowData.set([newEntry, ...currentData]);
  
  console.log('‚úÖ Grid updated. Total rows:', this.rowData().length);
}
What This Does:
‚úÖ Minimum 3 characters required - Shows message if less than 3 characters
‚úÖ Detailed console logging - You'll see:
What you're searching for
Full API response
Each employee's data structure
What gets selected
What gets added to grid
‚úÖ Console Output Example:
üîç Searching for: may
‚úÖ API Response - Total Results: 5
üìã Full API Data: [{...}, {...}, ...]
Employee 1: {fullName: "...", emailAddress: "...", ...}
Display Value: Mayank SHAH (mayank.p.shah@asia.bnpparibas.com)
‚úÖ Options created: 5
‚úÖ When you select:
‚úÖ Employee Selected: {fullName: "...", emailAddress: "...", ...}
üìß Employee Email: mayank.p.shah@asia.bnpparibas.com
üë§ Employee Name: Mayank SHAH
üéØ Employee received in visibility component: {...}
üìã Employee properties: {fullName: ..., emailAddress: ..., ...}
‚ûï New entry to be added: {...}
‚úÖ Grid updated. Total rows: 1
Now open your browser console and search for an employee. You'll see exactly what data structure comes from the API, and we can map it correctly to the grid! üéØ
